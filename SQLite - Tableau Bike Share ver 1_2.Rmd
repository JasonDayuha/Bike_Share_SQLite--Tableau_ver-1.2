---
title: "SQLite + Tableau: Bike-Share Navigate Speedy Success?"
author: "Jason D."
date: "2023-04-01"
output:
  pdf_document:
    toc: yes
  html_document:
    toc: yes
    theme: united
--- 

```{r setup, warning= FALSE , include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```
# 1. Introduction

This is a capstone project from Google’s Data Analyst curriculum program.  A bike share program in Chicago would like to increase its future success which depends on maximizing the number of annual memberships in its program. The company has provided data to be analyzed to  aid with the marketing team in finding strategies to convert casual riders to annual members.

# 2. Ask Guided Questions

2.1 Characters and teams:

* Cyclistic: A bike-share program that features more than 5,800 bicycles and 600 docking stations.

* Lily Moreno: The director of marketing and your manager. Moreno is responsible for the development of campaigns and initiatives to promote the bike-share program. These may include email, social media, and other channels.

* Cyclistic marketing analytics team: A team of data analysts who are responsible for collecting, analyzing, and reporting data that helps guide Cyclistic marketing strategy. 

* Cyclistic executive team: The notoriously detail-oriented executive team will decide whether to approve the recommended marketing program.

2.2 Business task:

* Lily Mareno the director of marketing, has assigned the question, "how do annual members and casual riders use Cyclistic bikes diﬀerently?"


2.3 Data:

* The data to be analyzed has been sourced from: Index of bucket "divvy-tripdata": [ Data set](https://divvy-tripdata.s3.amazonaws.com/index.html). The data is available by Motivate International Inc. under this [license](https://ride.divvybikes.com/data-license-agreement). This is public data for the purpose of exploring how diﬀerent customer types are using Cyclistic bikes. Regarding data-privacy issues, the historical purchases using personal payment information and the bike rental fare is not provided.

# 3. Preparing Data for Exploration
Once data has been downloaded into a local computer, it is secured with an encrypted password. The last 12 months of data will be analyzed for the purpose of this project. Data comes in 12 CVS files for corresponding to the last 12 months.

The data analysis will be analyzed through Sqlite specifically DB Browser which  is a serverless relational  database written in the  program language called Structured Query Language. The  Relational database store and provide access to data points that are in some way related to one another. Tableau an online data visualization tool will also be used to generate graphical representation of that data being analyzed.

The purpose of using sqlite and Tableau in analyzing the bike share data is part of the educational exploration in my data analysis journey. In learning to use sqlite in this project I have found that sqlite requires very little computer system resource to store and process the data. In contrast to R program and also MS Excel, computer system resource requirements is very low allowing for low end computer to be used in the analysis. The down side is, due to a different program language in sqlite, more time is required to learn a program task.

Regarding the quality of this data, it is considered data that has been generated by Lyft Bikes and Scooters, LLC (“Bikeshare”) that operates in the City of Chicago’s (“City”) Divvy bicycle sharing service.

# 4. Process Data from Dirty to Clean

Please refer to the Appendix regarding the SQLite query that is used to accomplish the following task:

4.1 Download the raw data Data set and combine into one table.

```{r combine,  eval=FALSE, include=TRUE}

-- 4.1 Download the raw data into your computer and combine into one table.

CREATE TABLE "bike_ride2" AS
SELECT *
FROM d202111
UNION ALL
SELECT *
FROM  d202112
UNION ALL
SELECT *
FROM d202201
UNION ALL
SELECT *
FROM d202202
UNION ALL
SELECT *
FROM d202203
UNION ALL
SELECT *
FROM d202204
UNION ALL
SELECT *
FROM d202205
UNION ALL
SELECT *
FROM d202206
UNION ALL
SELECT *
FROM d202207
UNION ALL
SELECT *
FROM d202208
UNION ALL
SELECT *
FROM d202209
UNION ALL
SELECT *
FROM d202210
```



#### Cleaning Data and Data Exploration:
  
4.2 To aide in future analysis create new columns for year, month , day , week , y/m/d , and h:m:s by adding extra columns to the data set.

```{r new_columns, eval=FALSE, include=TRUE}

--4.2 To aide in future analysis create new columns for year, month , day , week , y/m/d , and h:m:s by addingextra columns to the data set.
--Add a column titled ride_length_min1 with values formated as integer

ALTER TABLE bike_ride2 ADD COLUMN ride_length_min1 INTEGER;
UPDATE bike_ride2 SET ride_length_min1 = 
(strftime('%s',ended_at)-strftime('%s',started_at))/60;

--Next we find the ride length subtracting  "ended_at" with "started_at"
select started_at, ended_at, 
from bike_ride2


-- We then exclude values of ride_length_min less then zero
create table "bike_ride2" as
select*
from bike_ride2
where ride_length_min >0


--Note to self--------------------------------------------------
--how do delete a column 
ALTER TABLE bike_ride2 DROP COLUMN ride_length_min;

--how to rename a COLUMN
ALTER TABLE bike_ride2 RENAME ride_length_min1 to ride_length_min;

-- how to filter the table for less/ greater than a number
SELECT *
FROM bike_ride2
where ride_length_min <0
LIMIT 10

-------------------------------------------------------------------
```


4.3 Find anomalies in the data, any missing data:  "nulls"
```{r delete_errors, eval=FALSE, include=TRUE}

--4.3 Find anomalies in the data, any missing data:  "nulls"
-- The following query shows that there are 899,236 Nulls  in end_station_name

select DISTINCT end_station_name, count(1)
from bike_ride2
group by  end_station_name
order by count(1) DESC

--the following query shows that there are 847,996 Null for start_station_name
select DISTINCT start_station_name, count(1)
from bike_ride2
group by  start_station_name
order by count(1) DESC

-- How many ridable types where used in the past year? 3 types- classic, docked, electric
select rideable_type, count (1)
from bike_ride2
group by rideable_type;

```


4.4  Check column format information
```{r column_inforation , eval=FALSE, include=TRUE}

-- 4.4 We can check the column information with the following code.

PRAGMA table_info(bike_ride2);

--looks like the all columns are formated in text including date columns such as started_at and ended_at

```
  
4.5 Visually Identify outliers in the raw data Using a scatter plot data. 

```{r explore_scatter , eval=FALSE, include=TRUE}
--4.5 Identify outliers in the raw data Using a scatter plot  data. 

select started_at, ride_length_min, member_casual
from bike_ride2

```
[Tableau Interactive Scatter Plot](https://public.tableau.com/views/BikeridelengthvsMonthoftheYear/Sheet1?:language=en-US&:display_count=n&:origin=viz_share_link) 
<img src="https://i.imgur.com/rAgpdf6.png" width= "800px">


4.6 Identify how users use the bike service.

* Bike ride acquired from a start station but was not returned to a end station: results 454,330
* The TYPE of bike taken from a start station but was not returned to a end station: results 454,330
* Bike use with NO  start station but returned to a end station: Results: only electric 403,090
* Bike usage with no indication of start station and end station: Results: only electric bike 444,906

```{r identify_usage, eval=FALSE, include=TRUE}

--4.6 
-- check how many bikes used that took a bike from a start station but was not returned to a end station: results 454,330 

SELECT  COUNT(1)
FROM bike_ride2
WHERE (start_station_name IS not NULL and  end_station_name IS NULL) 

--what bike types were used which was picked up from a start station but not returned to an end station?results: classic:4333 , docked 2568 , electric 447,429

SELECT rideable_type, count(1)
from bike_ride2
where start_station_name IS not NULL and  end_station_name IS NULL
group by rideable_type;

-- what about the other way around, where users use a bike outside a station, and 
--returned it to a station? Results: only electri 403,090

SELECT rideable_type, count(1)
from bike_ride2
where start_station_name IS  NULL and  end_station_name IS not NULL
group by rideable_type;

--Is there any bikes where the start and end stations where not used?Results: electric bike 444,906

SELECT rideable_type, count(1)
from bike_ride2
where start_station_name IS  NULL and  end_station_name IS NULL
group by rideable_type; 

```
  
It looks like electric bikes do not need a station for it to be used. Base on our search electric bikes can be used without using starting or end stations which is why there is a lot of missing data represented by a null in electric bike types. The results show any other bike types that has a null in starting or end stations are anomalies and should be excluded. To clean our data set to exclude bike types other then electric bikes that has a null in start and end stations, we identify the nulls by doing the following:

4.7 Delete rows containing "nulls" in the following situations

* stations with warehouse, bases
* geographic coordinates with null
* stations with null for classic or dock bikes


```{r null, eval=FALSE, include=TRUE}

4.7 
--Note to self: Use  the "case", a conditional command.This work by, When ever there is a null, there is a 1. the "end" is used at the end of a conditonal command.The counted 1s is put in a column using "AS".

--After running the query below, the following query shows that classic and docked bikes have nulls in end station totalling 4333 and 2568 respectively


SELECT rideable_type, 
       COUNT(CASE WHEN start_station_name IS NULL THEN 1 END) AS null_start_station_count,
       COUNT(CASE WHEN end_station_name IS NULL THEN 1 END) AS null_end_station_count
FROM bike_ride2
WHERE rideable_type IN ('docked_bike', 'classic_bike')
GROUP BY rideable_type;


--Finding other missing data in the geographical coordinates


-- Check if there is nulls in the geographical coordinates:results- classic 3263, dock 2568
SELECT rideable_type, count(1)
from bike_ride2
where start_lat IS  NULL or start_lng is null or end_lat is null or end_lng IS NULL
group by rideable_type;


-- Once all missing data are identfied represented by "null" we  mark any rows by creating a new column named "exclude".

ALTER table bike_ride2 add COLUMN exclude TEXT;



--Now that we have an exclude column, we mark z for stations with a NULL. Note that it shows that docked and classic bike contains anomalies so those bike types will apply in this case. result: 1070 rows has been marked exclude.


UPDATE bike_ride2
set exclude = 'z'
where (start_station_name is null or end_station_name is null )
and rideable_type in(  'docked_bike', 'classic_bike');



--for any rows that have a null  for geographical coordinates, we will exlude since we can not map that ride visually.

UPDATE bike_ride2
SET exclude = "Y"
where start_lat is NULL or start_lng is null or end_lat is null and end_lng is null ;



--It turns out that there are warehouse and bases in the stations not relating to customers usage but more of a maintenance operation.We must exclude any location with any station with warehouse or bases

--Finding which rows have base or warehouse in them. Results:2122
select *
from bike_ride2
where(UPPER(start_station_name) LIKE '%BASE%' OR UPPER(end_station_name) LIKE '%BASE%' OR UPPER(start_station_name) LIKE '%WAREHOUSE%' OR UPPER(end_station_name) LIKE '%WAREHOUSE%');


--next we mark these rows with and X; 

update bike_ride2
set exclude= 'X'
where(UPPER(start_station_name) LIKE '%BASE%' OR UPPER(end_station_name) LIKE '%BASE%' OR UPPER(start_station_name) LIKE '%WAREHOUSE%' OR UPPER(end_station_name) LIKE '%WAREHOUSE%');

select *
from bike_ride2
where exclude is 'z'



--Finally we create a table that is considered clean data set,it will excluding the following:

--stations with warehouse, bases

--geographic coordinates with null

-- stations with null for classic or dock bikes

--in other words when the Exclude column does not contain X , Y , Z. 

CREATE TABLE bike_ride_clean AS
SELECT *
FROM bike_ride2
WHERE exclude is NULL
```

# 5 Analysis

```{r stat_summery, eval=FALSE, include=TRUE}
--5.1 Statistical summery
SELECT 
    member_casual,
    COUNT(*) as total_trips,
    AVG(ride_length_min) as avg_ride_length_mins,
    SUM(ride_length_min) / 60 as total_bike_ride_length_hr,
    SUM(CASE WHEN rideable_type = 'electric_bike' THEN ride_length_min ELSE 0 END) / 60 as total_electric_bike_ride_length_hr,
    SUM(CASE WHEN rideable_type = 'docked_bike' THEN ride_length_min ELSE 0 END) / 60 as total_docked_bike_ride_length_hr,
    SUM(CASE WHEN rideable_type = 'classic_bike' THEN ride_length_min ELSE 0 END) / 60 as total_classic_bike_ride_length_hr
FROM bike_ride_clean
WHERE start_station_name IS NOT NULL AND end_station_name IS NOT NULL -- Exclude rows with null values
GROUP BY member_casual;
```

[5.1 Statistical Summery ] <img src="https://imgur.com/kp5wN74.png" width= "1000px">

Members totaled 2,593,039 rides compared to casual members with 1,741,281 total rides in the last 12 months of November 2021 to October 2022. In contrast the casual member, used Cyclistic bike service longer than annual members.

Base on the bike ride count throughout November 2021 to October 2022, there were more bike use starting from the summer months of May to October for both casual and annual members. Daily bike usage range from 8,000 rides to as high as 16,000 in bike ride daily. For months of June and July member daily ride count  surges up to 20,000 ride  were as casual members peak at 16,000 rides daily.



```{r graph, eval=FALSE, include=TRUE}

--5.2 scatter plot 
-- Query used to generate scatter plot in tableau
SELECT 
start_time,
	ride_length_min,
	member_casual,
	rideable_type
FROM bike_ride_clean

```
[5.2 Tableau Interactive Ride Count Scatter Pot ](https://public.tableau.com/views/DailyRideCount/Sheet12)
<img src="https://i.imgur.com/9Mbqdcl.png" width= "1000px">
 
Bike Usage trends throughout the day:

For casual riders, there’s a noticeable uptick in bike usage starting in the last week of May. These riders predominantly choose the hours between 11 am and 4 pm for their rides. Notably, during the months of June and July, the 5 pm hour witnesses a significant surge. The cumulative number of rides for specific week segments at this hour reaches approximately 8,000

```{r heatmap,eval=FALSE, include=TRUE}
--5.2.1
--Query Used to create heat map

-- casual
SELECT start_year, start_month,start_week, start_time
FROM bike_ride_clean
where member_casual = 'casual'


--5.2.2
-- member
SELECT start_year, start_month,start_week, start_time
FROM bike_ride_clean
where member_casual = 'member'

```


[5.2.1 Tableau Interactive chart: Most Popular Time of Day to Bike Ride - Casual ](https://public.tableau.com/views/Causlaheatmap/Sheet1?:language=en-US&:display_count=n&:origin=viz_share_link)
<img src="https://i.imgur.com/2z3DbJV.png" width= "1000px">


[5.2.2 Tableau Interaactive chart: Most Popular Time to  Bike Ride - Members ](https://public.tableau.com/views/HeatMapPopularTimetoBikeRide-Member/Sheet1?:language=en-US&:display_count=n&:origin=viz_share_link) 
<img src="https://i.imgur.com/XF5xmE8.png" width= "1000px">


Popular time for bike ride use is further illustrated in this radial graph of Ride Count vs All time of the day from Nov 2021 to Oct 2022. It is clear that the ride count increases around 6 am to 9am and again slowly increase from 3pm peaking to 5pm.


```{r radial_bar, eval=FALSE, include=TRUE}
--5.3 & 5.5
-- Query used to create radial bar graph
SELECT 
start_time,
	ride_length_min,
	member_casual,
	rideable_type
FROM bike_ride_clean

```

[5.3 Tableau Interactive Chart for Radial Bike ride Count ](https://public.tableau.com/views/CntvsmonthRadialBarChart-RideLengthvsAllTimeofDay/average)
 <img src="https://i.imgur.com/0qUZhtl.png" width= "1000px"> 

What day of the week is most popular to bike riders? 


From Nov 2021 to Oct 2022, member users tend to be most active during the beginning of the week peaking on Wednesday at totaling at 388,275 trips. Inversely casual riders are most active during Saturday at 350,037 rides.


```{r weekly_bar, eval=FALSE, include=TRUE}

--5.4 Finding the most popular day of the week to ride for the last 12 months.

--Note to self: start_day_of_week is represented by number 0 to 6, 0 being Sunday in the data set. We use "case" to change the the numbers to the actual name of the day. When we use "case", there is "end "  to end the conditional statement. After the " as" the name of the column is stated. Here we count  the ride id, and group the data by day of the week.

SELECT 
    CASE 
        WHEN start_day_of_week = 0 THEN 'Sunday'
        WHEN start_day_of_week = 1 THEN 'Monday'
        WHEN start_day_of_week = 2 THEN 'Tuesday'
        WHEN start_day_of_week = 3 THEN 'Wednesday'
        WHEN start_day_of_week = 4 THEN 'Thursday'
        WHEN start_day_of_week = 5 THEN 'Friday'
        WHEN start_day_of_week = 6 THEN 'Saturday'
    END AS day_of_week, 
    COUNT(ride_id) AS ride_count
FROM bike_ride_clean
GROUP BY start_day_of_week
```

[5.4 Tableau Interactive chart ](https://public.tableau.com/views/MostPopulardayofweektobikerideinPast12Months/Sheet1?:language=en-US&:display_count=n&:origin=viz_share_link) 
<img src="https://i.imgur.com/Q6BOW8Q.png" width= "1000px">

Casual and Member users display a notable inverse relationship between ride counts and ride durations. While Member users predominantly utilize the Cyclistic bike share system, Casual users tend to engage in longer rides. This suggests that Casual users may often use Cyclistic bikes for leisurely activities over extended periods, whereas Members might lean towards shorter commutes or quick errands. The radial graph vividly illustrates these differences in ride patterns, highlighting the varying ride lengths at different times of the day from Nov 2021 to Oct 2022. Quantitatively, Member average ride length through out the day is about 12 minutes. However casual member vary drastically from 14 mins in the moring 6am to as high as 25 minutes around noon.


[5.5 Average Ride Length Vs All time of the Day ](https://public.tableau.com/views/PracticeRadialBarChart-RideLengthvsAllTimeofDay/average?:language=en-US&:display_count=n&:origin=viz_share_link)
<img src="https://i.imgur.com/46n8ECu.png" width= "1000px">


Ride length is longer for the classic bike followed by electric and docked bikes for casual member . Annual members do not use dock bikes at all and prefer classic bike or electric bikes.

```{r eval=FALSE, include=TRUE}

--5.5
-- bike types vs bike length -- in a year
select rideable_type, ride_length_min, start_month
FROM bike_ride_clean
WHERE member_casual is 'member'



-- <img src="https://i.imgur.com/eMCOjly.png" width= "800px">

--To create a group bar graph from the query above, we must pivot the table:
  
FROM columns- rideable_type, ride_length_min, start_month To start_month, and the rest of the columns are electric, docked, classic with ride length in their cells.

--The following query achieves this transformation. We take the start_date and extract the year and all the minutes for each date. 


--members
SELECT 
    strftime('%Y-%m', start_date) AS year_month,
    SUM(CASE WHEN rideable_type = 'docked_bike' THEN ride_length_min ELSE 0 END) AS docked_bike,
    SUM(CASE WHEN rideable_type = 'electric_bike' THEN ride_length_min ELSE 0 END) AS electric_bike,
    SUM(CASE WHEN rideable_type = 'classic_bike' THEN ride_length_min ELSE 0 END) AS classic_bike
FROM bike_ride_clean
WHERE member_casual = 'member'
GROUP BY year_month
ORDER BY year_month;

--casual:
SELECT 
    strftime('%Y-%m', start_date) AS year_month,
    SUM(CASE WHEN rideable_type = 'docked_bike' THEN ride_length_min ELSE 0 END) AS docked_bike,
    SUM(CASE WHEN rideable_type = 'electric_bike' THEN ride_length_min ELSE 0 END) AS electric_bike,
    SUM(CASE WHEN rideable_type = 'classic_bike' THEN ride_length_min ELSE 0 END) AS classic_bike
FROM bike_ride_clean
WHERE member_casual = 'casual'
GROUP BY year_month
ORDER BY year_month;
```



[5.5 Tableau Interactive Chart Members-  Bike Type Vs Bike Ride Length](https://public.tableau.com/views/Member-BikeTypeVsBikeRideLength/Sheet1?:language=en-US&:display_count=n&:origin=viz_share_link) 
<img src="https://imgur.com/uPoJ7Mz.png" width= "1000px">


[5.5 Tableau Interactive Chart Casual - Bike Type Vs Bike Ride Length ](https://public.tableau.com/views/biketypevsridelengthcasual/Sheet1?:language=en-US&:display_count=n&:origin=viz_share_link)
<img src="https://i.imgur.com/CjroPK7.png" width= "1000px">


Cyclistic bike use is very popular for casual and annual members around the “Loop” area of the city of Chicago, a prime business and tourist location.


```{r geo_map_5.6,eval=FALSE, include=TRUE}

--5.6

select start_station_name, start_lat, start_lng, member_casual
from bike_ride_clean
```

[5.6 Tableau Interactive chart Popular Bike Station Used In Past 12 Months ](https://public.tableau.com/views/PopularBikeStationUsedInPast12Months/Sheet1?:language=en-US&:display_count=n&:origin=viz_share_link) 
<img src="https://i.imgur.com/zHTY3Ot.png" width= "1000px">

Casual riders out number annual members around the area due to the high tourist attraction and parks, reflecting bike use for leisurely activity. In contrast, members users bike uses reflect the act of commuting for work or other business activity such as running errands. The 2nd popular area for Cyclistic bike use is north of the Loop around Wrigley Field.


```{r geo_map_5.7, eval=FALSE, include=TRUE}

--5.7
--The Top 100 bike stations for both casual and member riders.

SELECT start_station_name, start_lat, start_lng, count(*) as station_count
FROM bike_ride_clean
WHERE start_station_name IS NOT NULL
GROUP BY start_station_name
ORDER BY station_count DESC
LIMIT 100;
```

[5.7 Tableau Inteactive chart Top 100 bike stations ](https://public.tableau.com/views/Top100popularbikestationsk/Sheet1?:language=en-US&:display_count=n&:origin=viz_share_link) 
<img src="https://i.imgur.com/AG8JZrw.png" width= "1000px">


```{r geo_map_5.8, eval=FALSE, include=TRUE}

--5.8
--note to self:The "IS NOT NULL" is to exclude data with null

SELECT start_station_name, start_lat, start_lng, COUNT(*) as station_count
FROM bike_ride_clean
WHERE start_station_name IS NOT NULL
GROUP BY start_station_name, start_lat, start_lng
ORDER BY station_count DESC
LIMIT 10;
```


[5. Tableau Interactive chart- Top 10 bike stations ](https://public.tableau.com/views/Top10bikestations/Sheet1?:language=en-US&:display_count=n&:origin=viz_share_link) 
<img src="https://i.imgur.com/nIUeUB9.png" width= "1000px">

# 6. Conclusion

#### How could your team and business apply your insights?

• Any promotions should be done on Saturday during peak hours of 1200 to 1600 hr. Specifically, in the  summer months from late May through August to maximize the promotional message to casual bike share riders.

#### What next steps would you or your stakeholders take based on your ﬁndings?

Promotional campaign focused on casual riders. Communicate to casual riders that there could be incentives to becoming member riders. • 1 month free or discounted price for 12 months subscription * Communicate to casual member who reach a ride length threshold that it may be beneficial economically to convert to an annual membership.



In summary, Cyclistic's data demonstrates that casual riders predominantly use bikes for leisure, especially on summer weekends, while annual members' usage suggests regular commuting, peaking midweek. Marketing strategies should thus target casual riders with summer promotions and consider membership incentives based on ride length. For annual members, ensuring bike availability during peak commuting times is crucial. One thing to note, although the analysis provides actionable insights, the absence of cost data presents a limitation and an opportunity for deeper understanding to refine promotional strategies further.


# 7. Appendix


```{r Appendix, ref.label = knitr::all_labels(), echo = TRUE, eval = FALSE}

```
